<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title>Trang hóa đơn</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="stylesheet" href="/listeo/css/style.css">
	<link rel="stylesheet" href="/listeo/css/main-color.css" id="colors">
	<link rel="icon" href="http://ttcntt.sgu.edu.vn/wp-content/uploads/2018/11/SGU-LOGO.png">
</head>
<style>
	#logo {
	    display: flex;
	    align-items: center;
	}
	#logo img {
	    max-height: 80px; /* Điều chỉnh kích thước tối đa theo nhu cầu */
	    max-width: 100%;
	}
	#logo a {
	    margin-left: 50px; /* Điều chỉnh khoảng cách giữa logo và các phần khác nếu cần */
	}
	@media only screen and (max-width: 767px) {
	    #logo img {
	        max-height: 40px; /* Điều chỉnh kích thước tối đa trên thiết bị di động */
	    }
	}
</style>
<style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        .main-chubin {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 60vh;
        }

        .chatbot {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 700px;
            height: 400px;
            display: flex;
            flex-direction: column;
        }

        .chatbot header {
            background-color: #007bff;
            color: #fff;
            padding: 10px;
            text-align: center;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .chatbox {
            list-style: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            max-height: 300px;
            flex: 1;
        }

        .chat {
            display: flex;
            align-items: flex-start;
            margin: 10px;
        }

        .chat p {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 8px;
            margin-top: 30px;
            margin-left: 20px;
        }

        .chat img {
            border-radius: 50%;
            margin-right: 30px;
            max-width: 55px;
            margin-left: 20px;
            margin-top: 20px;
        }

        textarea {
            flex: 1;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            resize: none;
            margin-right: 10px;
            min-height: 50px;
        }

        #send-btn img {
            max-width: 50px;
        }

        .chat-input {
            display: flex;
            align-items: center;
            padding: 10px;
        }
    </style>
<body>

	<div id="wrapper">
		<header id="header-container" class="fixed fullwidth dashboard">
			<div id="header" class="not-sticky">
				<div class="container">
				
					<div class="left-side">
						<div id="logo">
							<a th:href="@{/redirect}"><img src="/images/logo_in.png" alt=""></a>
							<a th:href="@{/redirect}" class="dashboard-logo"><img
								src="/images/logo_in.png" alt=""></a>
						</div>
						<div class="mmenu-trigger">
							<button class="hamburger hamburger--collapse" type="button">
								<span class="hamburger-box"> <span
									class="hamburger-inner"></span>
								</span>
							</button>
						</div>
					</div>

					<div class="right-side">
						<div class="header-widget">
							<div class="user-menu">
								<div class="user-name">
									<span><img th:src="${session.admin.avatar}" alt=""></span>Tài khoản
								</div>
								<ul>
									<li><a th:href="@{/dashboard}"><i
											class="sl sl-icon-settings"></i> Tổng quan</a></li>
									<li><a th:href="@{/dashboard-orders}"><i
											class="sl sl-icon-envelope-open"></i> Hóa đơn</a></li>
									<li><a th:href="@{/dashboard-wallet}"><i
											class="fa fa-calendar-check-o"></i> Ví dịch vụ</a></li>
									<li><a th:href="@{/list_user}"><i
											class="sl sl-icon-user"></i> Tài khoản</a></li>
									<li><a th:href="@{/list_product}"><i 
											class="sl sl-icon-bag"></i> Sản phẩm</a></li>
									<li><a th:href="@{/contact_gpt}"><i 
											class="sl sl-icon-question"></i> Giúp đỡ</a></li>
									<li><a th:href="@{/logout-admin}"><i
											class="sl sl-icon-power"></i> Đăng xuất</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</header>
		<div class="clearfix"></div>
		<div id="dashboard">


			<a href="#" class="dashboard-responsive-nav-trigger"><i
				class="fa fa-reorder"></i> Dashboard Navigation</a>
			<div class="dashboard-nav">
				<div class="dashboard-nav-inner">

					<ul data-submenu-title="Main">
						<li><a th:href="@{/dashboard}"><i
								class="sl sl-icon-settings"></i> Tổng quan</a></li>
						<li><a th:href="@{/dashboard-orders}"><i
								class="fa fa-calendar-check-o"></i> Hóa đơn</a></li>
						<li><a th:href="@{/dashboard-wallet}"><i
								class="sl sl-icon-wallet"></i> Ví dịch vụ</a></li>
						<li><a th:href="@{/list_user}"><i
								class="sl sl-icon-user"></i> Tài khoản</a></li>
						<li><a th:href="@{/list_product}"><i 
								class="sl sl-icon-bag"></i> Sản phẩm</a></li>
						<li class="active"><a th:href="@{/contact_gpt}"><i 
								class="sl sl-icon-question"></i> Giúp đỡ</a></li>
						<li><a th:href="@{/logout-admin}"><i
								class="sl sl-icon-power"></i> Đăng xuất</a></li>
					</ul>
				</div>
			</div>

			<div class="dashboard-content">

				<!-- Titlebar -->
				<div id="titlebar">
					<div class="row">
						<div class="col-md-12">
							<h2>Hỗ trợ</h2>
							<!-- Breadcrumbs -->
							<nav id="breadcrumbs">
								<ul>
									<li><a href="#">Home</a></li>
									<li>Hỗ trợ</li>
								</ul>
							</nav>
						</div>
					</div>
				</div>

				<!-- --------------------- Start ------------------------------ -->
				
				<div class="main-chubin">
			        <div class="chatbot">
			            <header>
			                <h2>Hỗ trợ trực tuyến</h2>
			            </header>
			            <ul class="chatbox">
			                <li class="chat incoming">
			                    <span><img src="https://i.pinimg.com/564x/aa/f9/cb/aaf9cb487381bc229f4b45444de660ff.jpg" alt=""></span>
			                    <p>Xin chào, tôi có thể giúp bạn vấn đề gì?</p>
			                </li>
			            </ul>
			            <div class="chat-input">
			                <textarea placeholder="Nhập tin nhắn ở đây..." spellcheck="false" required></textarea>
			                <span id="send-btn"><img src="https://img.icons8.com/?size=256&id=ZznWGhUzgWtS&format=png" alt=""></span>
			            </div>
			        </div>
			    </div>
				
				<!-- --------------------- End ---------------------------- -->
				
			</div>
		</div>
	</div>


	<script type="text/javascript" src="/scripts/jquery-3.6.0.min.js"></script>
	<script type="text/javascript"
		src="/scripts/jquery-migrate-3.3.2.min.js"></script>
	<script type="text/javascript" src="/scripts/mmenu.min.js"></script>
	<script type="text/javascript" src="/scripts/chosen.min.js"></script>
	<script type="text/javascript" src="/scripts/slick.min.js"></script>
	<script type="text/javascript" src="/scripts/rangeslider.min.js"></script>
	<script type="text/javascript" src="/scripts/magnific-popup.min.js"></script>
	<script type="text/javascript" src="/scripts/waypoints.min.js"></script>
	<script type="text/javascript" src="/scripts/counterup.min.js"></script>
	<script type="text/javascript" src="/scripts/jquery-ui.min.js"></script>
	<script type="text/javascript" src="/scripts/tooltips.min.js"></script>
	<script type="text/javascript" src="/scripts/custom.js"></script>
	<script src="/scripts/moment.min.js"></script>
	<script src="/scripts/daterangepicker.js"></script>
	
	<script>
	// Lấy các phần tử HTML mà script sẽ tương tác
	const chatbotToggler = document.querySelector(".chatbot-toggler");
	const closeBtn = document.querySelector(".close-btn");
	const chatbox = document.querySelector(".chatbox");
	const chatInput = document.querySelector(".chat-input textarea");
	const sendChatBtn = document.querySelector(".chat-input span");

	let userMessage = null; // Biến để lưu trữ tin nhắn của người dùng
	const API_KEY = "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"; 
	// Chiều cao ban đầu của ô nhập tin nhắn
	const inputInitHeight = chatInput.scrollHeight;

	const createChatLi = (message, className, isUser = false) => {
	    // Tạo một phần tử <li> trong chat với nội dung và className được chuyển vào
	    const chatLi = document.createElement("li");
	    chatLi.classList.add("chat", `${className}`);

	    if (isUser) {
	        chatLi.innerHTML = `<span><img src="https://i.pinimg.com/originals/61/cd/1c/61cd1c9a69fb5f93db1a35a476b97b35.jpg" alt=""></span><p></p>`;
	    } else {
	        chatLi.innerHTML = `<span><img src="https://i.pinimg.com/564x/aa/f9/cb/aaf9cb487381bc229f4b45444de660ff.jpg" alt=""></span><p></p>`;
	    }

	    chatLi.querySelector("p").textContent = message;
	    return chatLi; // Trả về phần tử <li> của chat
	}

	// Hàm gửi yêu cầu và nhận phản hồi từ API OpenAI
	const generateResponse = (chatElement) => {
	    const API_URL = "https://api.openai.com/v1/chat/completions";
	    const messageElement = chatElement.querySelector("p");

	    // Xác định các thuộc tính và thông báo cho yêu cầu API
	    const requestOptions = {
	        method: "POST",
	        headers: {
	            "Content-Type": "application/json",
	            "Authorization": `Bearer ${API_KEY}`
	        },
	        body: JSON.stringify({
	            model: "gpt-3.5-turbo",
	            messages: [{role: "user", content: userMessage}],
	        })
	    }

	    // Gửi yêu cầu POST tới API, nhận phản hồi và chuyển thành dạng văn bản
	    fetch(API_URL, requestOptions).then(res => res.json()).then(data => {
	        messageElement.textContent = data.choices[0].message.content.trim();
	    }).catch(() => {
	        messageElement.classList.add("error");
	        messageElement.textContent = "Oops! Something went wrong. Please try again.";
	    }).finally(() => chatbox.scrollTo(0, chatbox.scrollHeight));
	}
	// Xử lý khi người dùng gửi tin nhắn
	const handleChat = () => {
	    userMessage = chatInput.value.trim(); // Get user entered message and remove extra whitespace
	    if(!userMessage) return;

	    // Xóa vùng văn bản đầu vào và đặt chiều cao của nó thành mặc định
	    chatInput.value = "";
	    chatInput.style.height = `${inputInitHeight}px`;

	    // Thêm tin nhắn của người dùng và AI vào khung chat
	    chatbox.appendChild(createChatLi(userMessage, "outgoing", true));
	    chatbox.scrollTo(0, chatbox.scrollHeight);

	    
	    setTimeout(() => {
	        // // Hiển thị tin nhắn "Thinking..." trong khi đang chờ phản hồi
	        const incomingChatLi = createChatLi("...", "incoming");
	        chatbox.appendChild(incomingChatLi);
	        chatbox.scrollTo(0, chatbox.scrollHeight);
	        generateResponse(incomingChatLi);
	    }, 600);
	}
	// Lắng nghe sự kiện khi người dùng nhập tin nhắn
	chatInput.addEventListener("input", () => {
	    // Điều chỉnh chiều cao của ô nhập tin nhắn dựa trên nội dung
	    chatInput.style.height = `${inputInitHeight}px`;
	    chatInput.style.height = `${chatInput.scrollHeight}px`;
	});
	// Lắng nghe sự kiện khi người dùng nhấn phím
	chatInput.addEventListener("keydown", (e) => {
	    // Nếu người dùng nhấn phím Enter mà không nhấn phím Shift và chiều rộng cửa sổ lớn hơn 800px, xử lý tin nhắn
	    if(e.key === "Enter" && !e.shiftKey && window.innerWidth > 800) {
	        e.preventDefault();
	        handleChat();
	    }
	});
	// Lắng nghe sự kiện khi người dùng nhấn nút gửi tin nhắn, 
	sendChatBtn.addEventListener("click", handleChat);
	</script>

	<script>
		$(function() {

			var start = moment().subtract(29, 'days');
			var end = moment();

			function cb(start, end) {
				$('#booking-date-range span').html(
						start.format('MMMM D, YYYY') + ' - '
								+ end.format('MMMM D, YYYY'));
			}
			cb(start, end);
			$('#booking-date-range').daterangepicker(
					{
						"opens" : "left",
						"autoUpdateInput" : false,
						"alwaysShowCalendars" : true,
						startDate : start,
						endDate : end,
						ranges : {
							'Today' : [ moment(), moment() ],
							'Yesterday' : [ moment().subtract(1, 'days'),
									moment().subtract(1, 'days') ],
							'Last 7 Days' : [ moment().subtract(6, 'days'),
									moment() ],
							'Last 30 Days' : [ moment().subtract(29, 'days'),
									moment() ],
							'This Month' : [ moment().startOf('month'),
									moment().endOf('month') ],
							'Last Month' : [
									moment().subtract(1, 'month').startOf(
											'month'),
									moment().subtract(1, 'month')
											.endOf('month') ]
						}
					}, cb);

			cb(start, end);

		});

		// Cài đặt hình ảnh và hoạt ảnh lịch
		$('#booking-date-range')
				.on(
						'show.daterangepicker',
						function(ev, picker) {
							$('.daterangepicker')
									.addClass(
											'calendar-visible calendar-animated bordered-style');
							$('.daterangepicker')
									.removeClass('calendar-hidden');
						});
		$('#booking-date-range').on('hide.daterangepicker',
				function(ev, picker) {
					$('.daterangepicker').removeClass('calendar-visible');
					$('.daterangepicker').addClass('calendar-hidden');
				});
	</script>

</body>
</html>